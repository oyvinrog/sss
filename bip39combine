#!/bin/bash

FILE="$1"
if [ -z "$FILE" ]; then
  echo "Usage: bip39combine <file-with-3-or-more-shares>"
  exit 1
fi

python3 - <<EOF
from shamir_mnemonic import combine_mnemonics
from mnemonic import Mnemonic

try:
    print(f"Reading $FILE")
    with open("$FILE", 'r') as f:
        lines = f.readlines()
    shares = [line.strip() for line in lines if line.strip()]
    if len(shares) < 3:
        print("❌ At least 3 shares are required.")
        exit(1)
except Exception as e:
    print("❌ Error reading file:", e)
    exit(1)

try:
    secret = combine_mnemonics(shares)
    mnemo = Mnemonic("english")
    phrase = mnemo.to_mnemonic(secret)
    print("✅ Recovered BIP39 Phrase:\n")
    print(phrase)
except Exception as e:
    print("❌ Failed to recover:", e)
    exit(1)
EOF
